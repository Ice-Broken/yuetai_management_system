{"remainingRequest":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\src\\views\\buyer\\teacher-excel.vue?vue&type=style&index=0&id=7b27bb86&scoped=true&lang=scss","dependencies":[{"path":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\src\\views\\buyer\\teacher-excel.vue","mtime":1686031785000},{"path":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1688620975306},{"path":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1688620975546},{"path":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1688620975454},{"path":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1688620980165},{"path":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1688620971327},{"path":"C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1688620975546}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci51cGxvYWQgewogIG1hcmdpbi10b3A6IDEwMHB4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKfQoKLmxvZyB7CiAgbWFyZ2luLXRvcDogMjBweDsKICBtYXJnaW4tbGVmdDogMzBweDsKfQo="},{"version":3,"sources":["C:\\Users\\Rick\\Desktop\\yuetai_management_system\\frontend\\src\\views\\buyer\\teacher-excel.vue"],"names":[],"mappings":";AAwLA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;EACjB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACpB;;AAEA,CAAC,CAAC,CAAC,EAAE;EACH,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EAChB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACnB","file":"C:/Users/Rick/Desktop/yuetai_management_system/frontend/src/views/buyer/teacher-excel.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"upload\" v-if=\"!tableData.length\">\n    <input type=\"file\" ref=\"file\" id=\"file\" style=\"display: none\" accept=\".xlsx\" @change=\"load\" />\n    <label for=\"file\" class=\"el-button el-button--primary\">\n      <i class=\"el-icon-upload\"></i>\n      上传文件\n    </label>\n  </div>\n  <div v-if=\"tableData.length\">\n    <el-button type=\"primary\" @click=\"log\" class=\"log\">打印当前成绩</el-button>\n    <el-table :data=\"tableData\" style=\"width: 100%\">\n      <el-table-column prop=\"name\" label=\"学生姓名\" width=\"180\">\n      </el-table-column>\n      <el-table-column prop=\"stucode\" label=\"学生学号\" width=\"180\">\n      </el-table-column>\n      <el-table-column :label=\"showScore\">\n        <template v-slot=\"scope\">\n          <el-input placeholder=\"请输入成绩\" v-model=\"scope.row.score\" clearable style=\"width: 200px\" :min=\"0\" :max=\"100\"\n            maxlength=\"3\" @focus=\"save(scope.row.score)\" @blur=\"change(scope.row.stucode, scope.row.score, scope.$index)\">\n          </el-input>\n        </template>\n      </el-table-column>\n    </el-table>\n    <echarts :option=\"option\" v-if=\"isShow\" @notShow=\"hide(value)\"></echarts>\n  </div>\n</template>\n<script setup>\nimport { ref } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport api from \"@/modules/api\";\nimport axios from \"axios\";\nimport uploadExcel from \"@/modules/upload-excel\";\nimport teacherPrint from \"@/modules/teacher/teacher-print\";\nimport { useStore } from \"vuex\";\nimport echarts from \"@/components/echarts\";\n\nlet router = useRouter();\nlet store = useStore();\nlet showScore = ref(\"\"); //表格上面的文字\nlet subject = ref(\"\");\napi(`select * from teacher where id='${localStorage.teacher}';`).then((res) => {\n  showScore.value = res.res[0].subject + \"成绩\";\n  switch (res.res[0].subject) {\n    case \"创新与实践\":\n      subject.value = \"innovate\";\n      break;\n    case \"马克思主义思想\":\n      subject.value = \"marx\";\n      break;\n    case \"高等数学\":\n      subject.value = \"math\";\n      break;\n    case \"VUE.js\":\n      subject.value = \"vue\";\n      break;\n    case \"Node.js\":\n      subject.value = \"node\";\n      break;\n    case \"MySQL数据库\":\n      subject.value = \"mysql\";\n      break;\n  }\n});\nlet tableData = ref([]);\nlet file = ref(null);\nlet isShow = ref(false);\nfunction isEchart() {\n  // 每次设置数量时候先清空\n  option.value.series[0].data.forEach((item, index) => {\n    item.value = 0;\n  });\n  // 设置标题\n  option.value.title.text = \"成绩单\";\n  // 遍历数组设置个数\n  tableData.value.forEach((item, index) => {\n    let i;\n    if (+item.score < 60 && item.score != \"\") {\n      i = 0;\n    } else if (+item.score > 60 && +item.score < 81) {\n      i = 1;\n    } else if (+item.score > 80 && +item.score < 90) {\n      i = 2;\n    } else if (+item.score > 89 && +item.score < 101) {\n      i = 3;\n    } else {\n      i = 4;\n    }\n    option.value.series[0].data[i].value++;\n  });\n  isShow.value = true;\n}\nfunction load() {\n  let fromD = new FormData();\n  fromD.append(subject.value, file.value.files[0]);\n  uploadExcel(fromD).then((res) => {\n    if (res.data.length) {\n      tableData.value = res.data;\n      isEchart()\n      isShow.value = true;\n    } else {\n      alert(\"excel格式上传失败或没有数据\");\n      router.go(0);\n    }\n  });\n}\n\nlet score;\nfunction save(s) {\n  score = +s;\n  console.log(score);\n}\nfunction change(id, s, index) {\n  console.log(score);\n  if (+s != +score && +s >= 0 && +s <= 100) {\n    let sql = `UPDATE achievement SET ${subject.value}='${s}' WHERE stucode='${id}';`;\n    api(sql).then((res) => {\n      // console.log(res);\n    });\n  } else {\n    tableData.value[index].score = score + \"\";\n  }\n}\n\nlet excel = ref(\"\");\nfunction log() {\n  let data = {\n    name: `${showScore.value}${Math.random().toString().substring(3, 7)}`,\n    data: [],\n  };\n  excel.value = store.state.excel + data.name + \".xlsx\";\n  data.data.push([\"姓名\", \"学号\", \"成绩\"]);\n  tableData.value.forEach((item, index) => {\n    data.data.push([\n      item.name,\n      item.stucode,\n      item.score == \"\" ? \"未录入\" : item.score,\n    ]);\n  });\n  teacherPrint({ data: data }).then((res) => {\n    window.open(excel.value);\n  });\n}\nlet option = ref({\n  title: {\n    text: \"成绩展示\",\n    left: \"center\",\n  },\n  color: [\"red\", \"green\", \"yellow\", \"blueviolet\", \"gray\"],\n\n  tooltip: {\n    trigger: \"item\",\n  },\n  legend: {\n    orient: \"vertical\",\n    left: \"left\",\n  },\n  series: [\n    {\n      name: \"访问来源\",\n      type: \"pie\",\n      radius: \"50%\",\n      data: [\n        { value: 0, name: \"不及格\" },\n        { value: 0, name: \"中等\" },\n        { value: 0, name: \"良好\" },\n        { value: 0, name: \"优秀\" },\n        { value: 0, name: \"未登记\" },\n      ],\n      emphasis: {\n        itemStyle: {\n          shadowBlur: 10,\n          shadowOffsetX: 0,\n          shadowColor: \"rgba(0, 0, 0, 0.5)\",\n        },\n      },\n    },\n  ],\n});\n\nfunction hide(value) {\n  isShow.value = false;\n}\n</script>\n<style scoped lang='scss'>\n.upload {\n  margin-top: 100px;\n  text-align: center;\n}\n\n.log {\n  margin-top: 20px;\n  margin-left: 30px;\n}\n</style>"]}]}